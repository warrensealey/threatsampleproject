<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Data Generation - Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <h1>Email Data Generation</h1>
        <nav>
            <a href="/" class="active">Dashboard</a>
            <a href="/config">Configuration</a>
        </nav>
    </header>

    <div class="container">
        <div class="card">
            <h2>Send Test Emails</h2>
            <div class="grid">
                <div>
                    <h3>Phishing Emails</h3>
                    <p>Generate and send phishing test emails based on PhishTank data.</p>
                    <button class="btn btn-primary" id="sendPhishingBtn">Send Phishing Emails</button>
                </div>
                <div>
                    <h3>EICAR Test Emails</h3>
                    <p>Send EICAR test file attachments for antivirus testing.</p>
                    <button class="btn btn-success" id="sendEicarBtn">Send EICAR Emails</button>
                </div>
                <div>
                    <h3>Cynic Test Emails</h3>
                    <p>Send Cynic test emails with password-protected VBS archives.</p>
                    <button class="btn btn-danger" id="sendCynicBtn">Send Cynic Emails</button>
                </div>
                <div>
                    <h3>GTUBE Spam Test</h3>
                    <p>Send a single GTUBE spam-test email containing the canonical GTUBE string.</p>
                    <button class="btn btn-warning" id="sendGtubeBtn">Send GTUBE Email</button>
                </div>
                <div>
                    <h3>Custom Email</h3>
                    <p>Send custom emails with configurable subject, body, display name, and optional attachments.</p>
                    <button class="btn btn-primary" id="sendCustomBtn">Send Custom Email</button>
                </div>
            </div>
            <div id="sendStatus" class="hidden"></div>
        </div>

        <div class="card">
            <h2>Email History</h2>
            <div id="history">
                <p class="loading">Loading history...</p>
            </div>
        </div>

        <div class="card">
            <h2>Scheduled Sends (Beta)</h2>
            <p>
                Configure one-off or recurring email sends. Schedules run inside the application
                while the Docker container is up.
            </p>
            <div class="form-group">
                <button class="btn btn-primary" id="createScheduleBtn">Create Schedule</button>
            </div>
            <div id="schedulesTable">
                <p class="loading">Loading schedules...</p>
            </div>
        </div>
    </div>

    <!-- Email Send Result Modal -->
    <div id="emailSendModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" id="emailSendModalClose">&times;</span>
            <h2 id="emailSendModalTitle">Email Send Results</h2>
            <div id="emailSendStatus">
                <p class="loading">Processing...</p>
            </div>
            <div id="emailSendConnectionInfo" class="hidden">
                <h3>Connection Information</h3>
                <div id="emailSendConnectionDetails"></div>
            </div>
            <div id="emailSendActions" class="hidden">
                <button class="btn btn-primary" id="closeEmailSendModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Phishing Warning Modal -->
    <div id="phishingWarningModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <h2 style="color: #d32f2f; margin-top: 0;">⚠️ Warning: Real Phishing URLs</h2>
            <div style="padding: 20px 0;">
                <p style="font-size: 16px; line-height: 1.6; margin-bottom: 15px;">
                    <strong>This feature downloads and sends REAL, active phishing URLs from the PhishTank website.</strong>
                </p>
                <p style="font-size: 16px; line-height: 1.6; margin-bottom: 15px;">
                    PhishTank is a collaborative clearing house for data and information about phishing on the Internet.
                    The URLs downloaded are <strong>real, active phishing sites</strong> that have been reported and verified.
                </p>
                <p style="font-size: 16px; line-height: 1.6; margin-bottom: 15px;">
                    <strong>Important:</strong> The emails generated using these URLs should be considered <strong>MALICIOUS</strong> and
                    <strong>MUST NOT</strong> be opened on production computers or any system where sensitive data is stored.
                </p>
                <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                    For more information about PhishTank, visit:
                    <a href="https://www.phishtank.com" target="_blank" rel="noopener noreferrer" style="color: #1976d2; text-decoration: underline;">
                        https://www.phishtank.com
                    </a>
                </p>
                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 15px; margin-bottom: 20px;">
                    <p style="margin: 0; font-weight: bold; color: #856404;">
                        ⚠️ Only use this feature in isolated test environments. Do not open these emails on production systems.
                    </p>
                </div>
            </div>
            <div class="btn-group" style="justify-content: center;">
                <button class="btn btn-danger" id="phishingWarningConfirmBtn">I Understand - Continue</button>
                <button class="btn btn-secondary" id="phishingWarningCancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Email Modal -->
    <div id="customEmailModal" class="modal hidden">
        <div class="modal-content" style="max-width: 700px;">
            <span class="modal-close" id="customEmailModalClose">&times;</span>
            <h2>Send Custom Email</h2>
            <form id="customEmailForm">
                <div class="form-group">
                    <label for="customSubject">Subject: <span style="color: red;">*</span></label>
                    <input type="text" id="customSubject" required placeholder="Enter email subject">
                </div>
                <div class="form-group">
                    <label for="customBody">Body: <span style="color: red;">*</span></label>
                    <textarea id="customBody" required rows="6" placeholder="Enter email body text"></textarea>
                </div>
                <div class="form-group">
                    <label for="customDisplayName">Sender Display Name (optional):</label>
                    <input type="text" id="customDisplayName" placeholder="e.g., John Doe">
                    <small style="color: #666; display: block; margin-top: 5px;">How the sender name will appear to recipients</small>
                </div>
                <div class="form-group">
                    <label for="customAttachment">Attachment (optional):</label>
                    <select id="customAttachment" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">None</option>
                        <option value=".zip">.zip (ZIP Archive)</option>
                        <option value=".com">.com (Executable-like)</option>
                        <option value=".scr">.scr (Screen Saver-like)</option>
                        <option value=".pdf">.pdf (PDF Document)</option>
                        <option value=".bat">.bat (Batch Script)</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">Select a harmless dummy attachment file type</small>
                </div>
                <div class="form-group">
                    <label for="customRecipients">Recipients: <span style="color: red;">*</span></label>
                    <input type="text" id="customRecipients" required placeholder="email1@example.com, email2@example.com">
                </div>
                <div class="form-group">
                    <label for="customTemplateSelect">Template (optional):</label>
                    <select id="customTemplateSelect">
                        <option value="">-- No Template --</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Select a saved template to quickly populate subject, body, display name, and attachment.
                    </small>
                </div>
                <div class="form-group">
                    <label for="customCount">Count:</label>
                    <input type="number" id="customCount" value="1" min="1" style="width: 100px;">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Send Email</button>
                    <button type="button" class="btn btn-secondary" id="saveCustomTemplateBtn">Save as Template</button>
                    <button type="button" class="btn btn-secondary" id="cancelCustomEmailBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Create/Edit Modal -->
    <div id="scheduleModal" class="modal hidden">
        <div class="modal-content" style="max-width: 720px;">
            <span class="modal-close" id="scheduleModalClose">&times;</span>
            <h2 id="scheduleModalTitle">Create Schedule</h2>
            <form id="scheduleForm">
                <input type="hidden" id="scheduleId">
                <div class="form-group">
                    <label for="scheduleName">Name:</label>
                    <input type="text" id="scheduleName" required placeholder="e.g., Monday phishing test">
                </div>
                <div class="form-group">
                    <label for="scheduleEmailType">Email Type:</label>
                    <select id="scheduleEmailType" required>
                        <option value="phishing">Phishing</option>
                        <option value="eicar">EICAR</option>
                        <option value="cynic">Cynic</option>
                        <option value="gtube">GTUBE</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="scheduleRecipients">Recipients (comma-separated):</label>
                    <input type="text" id="scheduleRecipients" required placeholder="email1@example.com, email2@example.com">
                </div>
                <div class="form-group">
                    <label for="scheduleCount">Count:</label>
                    <input type="number" id="scheduleCount" value="1" min="1" style="width: 100px;">
                </div>
                <div class="form-group">
                    <label for="scheduleConfigName">Email Configuration:</label>
                    <select id="scheduleConfigName">
                        <option value="">Use current active configuration</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="scheduleType">Schedule Type:</label>
                    <select id="scheduleType" required>
                        <option value="one_off">One-off</option>
                        <option value="interval">Every N hours</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div id="scheduleOneOffFields" class="form-group">
                    <label>Run at (local time):</label>
                    <input type="datetime-local" id="scheduleOneOffDateTime">
                </div>
                <div id="scheduleIntervalFields" class="form-group hidden">
                    <label for="scheduleIntervalHours">Every N hours:</label>
                    <input type="number" id="scheduleIntervalHours" value="24" min="1" style="width: 120px;">
                </div>
                <div id="scheduleWeeklyFields" class="form-group hidden">
                    <label>Days of week:</label>
                    <div class="weekday-checkboxes">
                        <label><input type="checkbox" value="MON" class="scheduleWeekday"> Mon</label>
                        <label><input type="checkbox" value="TUE" class="scheduleWeekday"> Tue</label>
                        <label><input type="checkbox" value="WED" class="scheduleWeekday"> Wed</label>
                        <label><input type="checkbox" value="THU" class="scheduleWeekday"> Thu</label>
                        <label><input type="checkbox" value="FRI" class="scheduleWeekday"> Fri</label>
                        <label><input type="checkbox" value="SAT" class="scheduleWeekday"> Sat</label>
                        <label><input type="checkbox" value="SUN" class="scheduleWeekday"> Sun</label>
                    </div>
                    <label for="scheduleWeeklyTime">Time of day (local):</label>
                    <input type="time" id="scheduleWeeklyTime" value="09:00">
                </div>
                <div class="form-group" id="scheduleCustomFields" class="hidden">
                    <p style="font-size: 0.9em; color: #555;">
                        For custom schedules, the subject/body/display name/attachment come from the
                        most recently used Custom Email form values on the dashboard.
                    </p>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Save Schedule</button>
                    <button type="button" class="btn btn-secondary" id="scheduleCancelBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>

